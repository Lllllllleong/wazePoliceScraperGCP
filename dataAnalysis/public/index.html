<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Police Alert Analysis</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet.timeline CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.timeline@1.6.0/dist/leaflet.timeline.min.css" />

    <!-- Flatpickr CSS for multi-date picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Disclaimer Modal -->
    <div id="disclaimer-modal" class="disclaimer-modal">
        <div class="disclaimer-content">
            <div class="disclaimer-header">
                <h2>‚ö†Ô∏è Important Notice & Disclaimer</h2>
            </div>
            <div class="disclaimer-body">
                <section>
                    <h3>üõë Notice on Data Collection</h3>
                    <p><strong style="color: #dc2626;">IMPORTANT: The near-real-time data feed is scheduled to be permanently discontinued as of November 30, 2025.</strong></p>
                    <p>A compliance review determined that the data collection methodology is not in alignment with Waze's Terms of Service. To responsibly address this, data collection will cease on the scheduled date. The existing data is retained for educational and analytical purposes.</p>
                </section>

                <section>
                    <h3>Educational & Portfolio Purpose</h3>
                    <p>This application is an experimental educational project created solely for learning purposes and
                        as a technical portfolio demonstration. It is not intended for commercial use, public
                        deployment, or as a reliable service.</p>
                </section>

                <section>
                    <h3>No Warranties or Guarantees</h3>
                    <p>This application and all data presented are provided "AS IS" without any warranties of any kind,
                        either express or implied. The creator makes no guarantees regarding:</p>
                    <ul>
                        <li>Accuracy, completeness, or reliability of the data</li>
                        <li>Availability or uptime of the service</li>
                        <li>Fitness for any particular purpose</li>
                        <li>Data freshness or real-time accuracy</li>
                    </ul>
                </section>

                <section>
                    <h3>Data Source Disclaimer</h3>
                    <p>All police alert data is sourced from third-party services and may be inaccurate, outdated,
                        incomplete, or false. This data should NOT be used for:</p>
                    <ul>
                        <li>Making driving or route decisions</li>
                        <li>Evading law enforcement</li>
                        <li>Any illegal activities</li>
                        <li>Critical safety or emergency decisions</li>
                        <li>Professional or commercial purposes</li>
                    </ul>
                </section>

                <section>
                    <h3>Prohibited Uses</h3>
                    <p>By using this application, you explicitly agree NOT to use the data or service to:</p>
                    <ul>
                        <li>Violate any local, state, or federal laws</li>
                        <li>Evade, obstruct, or interfere with law enforcement activities</li>
                        <li>Engage in any illegal or criminal activities</li>
                        <li>Cause harm to individuals or property</li>
                        <li>Redistribute or commercialize the data</li>
                    </ul>
                </section>

                <section>
                    <h3>Limitation of Liability</h3>
                    <p>The creator of this application shall NOT be held liable for:</p>
                    <ul>
                        <li>Any damages arising from use of this application</li>
                        <li>Any decisions made based on data from this application</li>
                        <li>Service interruptions, data loss, or technical failures</li>
                        <li>Any legal consequences resulting from use of this application</li>
                        <li>Actions taken by third parties who access data from this application</li>
                    </ul>
                </section>

                <section>
                    <h3>No Agency or Representation</h3>
                    <p>This application does not act on behalf of any government agency, law enforcement, or official
                        organization. It has no authority to provide official information or represent any entity.</p>
                </section>

                <section>
                    <h3>Assumption of Risk</h3>
                    <p>By clicking "I Acknowledge" below, you:</p>
                    <ul>
                        <li>Acknowledge this is an experimental, educational project</li>
                        <li>Understand the data may be inaccurate or unreliable</li>
                        <li>Agree not to use the data for illegal purposes or to evade law enforcement</li>
                        <li>Accept all risks associated with using this application</li>
                        <li>Release the creator from any and all liability</li>
                        <li>Confirm you are using this application at your own risk</li>
                    </ul>
                </section>

                <p class="disclaimer-warning"><strong>If you do not agree to these terms, please close this browser tab
                        immediately.</strong></p>
            </div>
            <div class="disclaimer-footer">
                <button id="disclaimer-accept-btn" class="btn btn-primary btn-large">I Acknowledge & Accept</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>Police Alert Analysis</h1>
            <p class="header-subtitle">
                Near real-time analysis of police alerts in the Sydney-Canberra region.<br>
                <br>
                    <strong style="color: var(--warning-color);">‚ö†Ô∏è Data Availability:</strong> Data feed discontinued as of Nov 30, 2025.<br>
                - Dates available in the calendar represent a full day of continuously sampled data. <br>
                - Days that are unavailable for selection, indicate that the data does not completely represent a whole day of activity.
            </p>
        </header>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="control-section">
                <h3>üìÖ Step 1: Select Dates to Load</h3>
                <div class="time-controls">
                    <div class="input-group">
                        <label for="date-picker">Select Days (maximum 7 days):</label>
                        <input type="text" id="date-picker" placeholder="Click to select dates..." readonly>
                    </div>
                    <div class="selected-dates-info">
                        <span id="selected-dates-count">No dates selected</span>
                    </div>
                    <div class="button-group">
                        <button id="reset-dashboard-btn" class="btn btn-warning">üîÑ Reset Dashboard</button>
                        <button id="load-data-btn" class="btn btn-primary" disabled>üì• Load Data</button>
                    </div>
                    <div id="loading-status" class="loading-status" style="display: none;">
                        <span class="loading-spinner">‚è≥</span>
                        <span id="loading-message">Loading alerts...</span>
                    </div>
                </div>
            </div>

            <div class="control-section" id="alert-filters-section">
                <h3>üîç Step 2: Alert Filters</h3>
                <div class="filter-controls" id="filter-controls">
                    <div class="input-group">
                        <label for="subtype-selection">Subtype Filters:</label>
                        <div class="subtype-filter-container">
                            <div id="subtype-tags" class="tag-selection-field">
                                <span class="tag-placeholder">No subtypes selected (showing all)</span>
                            </div>
                            <select id="subtype-dropdown" class="filter-dropdown">
                                <option value="" disabled selected>Select a subtype to add...</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="street-selection">Street Filters:</label>
                        <div class="street-filter-container">
                            <div id="street-tags" class="tag-selection-field">
                                <span class="tag-placeholder">No streets selected (showing all)</span>
                            </div>
                            <select id="street-dropdown" class="filter-dropdown">
                                <option value="" disabled selected>Select a street to add...</option>
                            </select>
                        </div>
                        <small class="filter-help-text">üí° Tip: "(No Street)" option filters alerts with no street
                            information</small>
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="verified-only-filter" checked>
                            <span>‚úì Show only verified alerts</span>
                        </label>
                        <small class="filter-help-text">Show alerts with at least 1 thumbs up</small>
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hume-highway-filter">
                            <span>üõ£Ô∏è Hume & Federal Highway Only</span>
                        </label>
                        <small class="filter-help-text">Automatically filters streets containing "Hume" or
                            "Federal"</small>
                    </div>
                    <button id="reset-filters" class="btn btn-secondary">Reset Filters</button>
                </div>
            </div>

            <div class="control-section">
                <h3>üìä Step 3: Choose Render Option</h3>
                <div class="stats-display">
                    <div class="stat-item">
                        <span class="stat-label">Total Alerts:</span>
                        <span class="stat-value" id="total-alerts">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Filtered Alerts:</span>
                        <span class="stat-value" id="filtered-alerts">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Date Range:</span>
                        <span class="stat-value" id="date-range">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Average Alert Reliability:</span>
                        <span class="stat-value" id="avg-reliability">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Average Alert Confidence:</span>
                        <span class="stat-value" id="avg-confidence">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Top City:</span>
                        <span class="stat-value" id="top-city">-</span>
                    </div>
                </div>
                <div class="button-group">
                    <button id="render-map-btn" class="btn btn-render" disabled>
                        üó∫Ô∏è Render Alerts Over Time
                    </button>
                    <button id="render-map-single-day-btn" class="btn btn-render" disabled>
                        üìÖ Render Alerts as Single Day
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Map Container -->
            <div class="map-section">
                <div class="map-header" id="map-header">
                    <h3>üó∫Ô∏è Alert Map</h3>
                </div>
                <div id="map"></div>
            </div>

            <!-- Alert List -->
            <div class="alert-list-section">
                <h3>üìã Alert Details</h3>
                <div class="alert-list-controls">
                    <input type="text" id="search-box" placeholder="Search by street, city, UUID...">
                </div>
                <div id="alert-list" class="alert-list">
                    <p class="loading-message">Loading alerts from Firestore...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet.timeline JS -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.timeline@1.6.0/dist/leaflet.timeline.min.js"></script>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, connectAuthEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Make Firebase available globally
        window.FirebaseApp = { initializeApp };
        window.FirebaseAuth = { getAuth, signInAnonymously, onAuthStateChanged, connectAuthEmulator };
    </script>

    <!-- Custom JS -->
    <script src="config.js"></script>
    <script src="app.js"></script>
</body>

</html>